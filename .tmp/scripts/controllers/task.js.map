{"version":3,"names":[],"mappings":"","sources":["controllers/task.js"],"sourcesContent":["'use strict';\n\napp.controller('TaskController', function($scope, $location, toaster, Task, Auth) {\n\n\tvar file;\n\tvar handleFileSelect = function(element, cb) {\n\t\tvar files = element.files;\n\t\tvar file = files[0];\n\t\tif (files && file) {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.addEventListener('load', function () {\n\t\t\t\tvar image = new Image();\n\t\t\t\timage.height = 100;\n\t\t\t\timage.title = file.name;\n\t\t\t\timage.src = this.result;\n\t\t\t\tcb(this.result);\n\t\t\t}, false);\n\n\t\t\treader.readAsDataURL(file);\n\t\t}\n\t};\n\t$scope.createTask = function() {\n\t\t//console.log('kaka')\n\t\t$scope.task.status = 'open';\n\t\t$scope.task.gravatar = Auth.user.profile.gravatar;\n\t\t$scope.task.name = Auth.user.profile.name;\n\t\t$scope.task.poster = Auth.user.uid;\n\n\t\tvar imgelement = document.getElementById('helpImg');\n\t\tif(imgelement.files.length>0){\n\t\t\tvar storageRef = firebase.storage().ref().child($scope.task.poster);\n\t\t\t// Get a reference to store file at photos/<FILENAME>.jpg\n\t\t\tvar photoRef = storageRef.child(file.name);\n\t\t\t// Upload file to Firebase Storage\n\t\t\tvar uploadTask = photoRef.put(file);\n\t\t\tuploadTask.on('state_changed', null, null, function(snapshot) {\n\t\t\t\tconsole.log('success')\n\t\t\t\tconsole.log(snapshot)\n\t\t\t\t// When the image has successfully uploaded, we get its download URL\n\t\t\t\tvar downloadUrl = uploadTask.snapshot.downloadURL;\n\t\t\t\t$scope.task.img = downloadUrl;\n\t\t\t\tTask.createTask($scope.task).then(function(ref) {\n\t\t\t\t\ttoaster.pop('success', 'Your call for help has been submitted.');\n\t\t\t\t\tdocument.getElementById('postimg').src = '';\n\t\t\t\t\t$scope.task = {description: '', title: '', help_type: '', image: '', status: 'open', gravatar: '', name: '', poster: ''};\n\t\t\t\t\t$location.path('/browse' + ref.key());\n\t\t\t\t\t$('#posModal').modal('hide');\n\t\t\t\t});\n\t\t\t});\n\t\t}else{\n\t\t\tTask.createTask($scope.task).then(function(ref) {\n\t\t\t\ttoaster.pop('success', 'Your call for help has been submitted.');\n\t\t\t\t$scope.task = {description: '', title: '', help_type: '', image: '', status: 'open', gravatar: '', name: '', poster: ''};\n\t\t\t\t$location.path('/browse' + ref.key());\n\t\t\t\t$('#posModal').modal('hide');\n\t\t\t});\n\t\t}\n\n\t};\n\n\t$scope.previewPostImage = function (that, type) {\n\t\tvar imgechge = document.getElementById('helpImg');\n\t\tfile = imgechge.files[0];\n\t\thandleFileSelect(imgechge, function (data) {\n\t\t\tdocument.getElementById('postimg').src = data;\n\t\t})\n\t};\n\n\t$scope.editTask = function(task) {\n\t\tTask.editTask(task).then(function() {\n\t\t\ttoaster.pop('success', 'Your call for help has been updated.');\n\t\t\t$('#ediModal').modal('hide');\n\t\t});\n\t};\n\n});\n"],"file":"controllers/task.js","sourceRoot":"/source/"}