{"version":3,"names":[],"mappings":"","sources":["controllers/task.js"],"sourcesContent":["'use strict';\r\n\r\napp.controller('TaskController', function($scope, $location, toaster, Task, Auth) {\r\n\r\n\tvar file;\r\n\t$scope.postImgPrw = false;\r\n\t$scope.postImg = '';\r\n\tvar handleFileSelect = function(element, cb) {\r\n\t\tvar files = element.files;\r\n\t\tvar file = files[0];\r\n\t\tif (files && file) {\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.addEventListener('load', function () {\r\n\t\t\t\tvar image = new Image();\r\n\t\t\t\timage.height = 100;\r\n\t\t\t\timage.title = file.name;\r\n\t\t\t\timage.src = this.result;\r\n\t\t\t\tcb(this.result);\r\n\t\t\t}, false);\r\n\r\n\t\t\treader.readAsDataURL(file);\r\n\t\t}\r\n\t};\r\n\t$scope.createTask = function() {\r\n\t\t//console.log('kaka')\r\n\t\t$scope.task.status = 'open';\r\n\t\t$scope.task.gravatar = Auth.user.profile.gravatar;\r\n\t\t$scope.task.name = Auth.user.profile.name;\r\n\t\t$scope.task.poster = Auth.user.uid;\r\n\r\n\t\tvar imgelement = document.getElementById('helpImg');\r\n\t\tif(imgelement.files.length>0){\r\n\t\t\tvar storageRef = firebase.storage().ref().child($scope.task.poster);\r\n\t\t\t// Get a reference to store file at photos/<FILENAME>.jpg\r\n\t\t\tvar photoRef = storageRef.child(file.name);\r\n\t\t\t// Upload file to Firebase Storage\r\n\t\t\tvar uploadTask = photoRef.put(file);\r\n\t\t\tuploadTask.on('state_changed', null, null, function(snapshot) {\r\n\t\t\t\tconsole.log('success')\r\n\t\t\t\tconsole.log(snapshot)\r\n\t\t\t\t// When the image has successfully uploaded, we get its download URL\r\n\t\t\t\tvar downloadUrl = uploadTask.snapshot.downloadURL;\r\n\t\t\t\t$scope.task.img = downloadUrl;\r\n\t\t\t\tTask.createTask($scope.task).then(function(ref) {\r\n\t\t\t\t\ttoaster.pop('success', 'Call for help has been submitted.');\r\n\t\t\t\t\tdocument.getElementById('postimg').src = '';\r\n\t\t\t\t\t$scope.task = {description: '', title: '', help_type: '', image: '', status: 'open', gravatar: '', name: '', poster: ''};\r\n\t\t\t\t\t$location.path('/browse' + ref.key());\r\n\t\t\t\t\t$('#posModal').modal('hide');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tTask.createTask($scope.task).then(function(ref) {\r\n\t\t\t\ttoaster.pop('success', 'Call for help has been submitted.');\r\n\t\t\t\t$scope.task = {description: '', title: '', help_type: '', image: '', status: 'open', gravatar: '', name: '', poster: ''};\r\n\t\t\t\t$location.path('/browse' + ref.key());\r\n\t\t\t\t$('#posModal').modal('hide');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t$scope.previewPostImage = function () {\r\n\t\tvar imgechge = document.getElementById('helpImg');\r\n\t\tfile = imgechge.files[0];\r\n\t\thandleFileSelect(imgechge, function (data) {\r\n\t\t\t$scope.postImgPrw = true;\r\n\t\t\t$scope.postImg = data;\r\n\t\t\t//document.getElementById('postimg').src = data;\r\n\t\t})\r\n\t};\r\n\r\n\t$scope.editTask = function(task) {\r\n\t\tTask.editTask(task).then(function() {\r\n\t\t\ttoaster.pop('success', 'Call for help has been updated.');\r\n\t\t\t$('#ediModal').modal('hide');\r\n\t\t});\r\n\t};\r\n\r\n});\r\n"],"file":"task.js"}