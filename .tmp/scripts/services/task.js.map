{"version":3,"names":[],"mappings":"","sources":["services/task.js"],"sourcesContent":["'use strict';\r\n\r\napp.factory('Task', function(FURL, $firebase, Auth) {\r\n\tvar ref = new Firebase(FURL);\r\n\tvar tasks = $firebase(ref.child('tasks')).$asArray();\r\n\tvar user = Auth.user;\r\n\r\n\tvar Task = {\r\n\t\tall: tasks,\r\n\r\n\t\tgetTask: function(taskId) {\r\n\t\t\treturn $firebase(ref.child('tasks').child(taskId));\r\n\t\t},\r\n\r\n\t\tcreateTask: function(task) {\r\n\t\t\ttask.datetime = Firebase.ServerValue.TIMESTAMP;\r\n\t\t\treturn tasks.$add(task).then(function(newTask) {\r\n\r\n\t\t\t\t// Create User-Tasks lookup record for POSTER\r\n\t\t\t\tvar obj = {\r\n\t\t\t\t\ttaskId: newTask.key(),\r\n\t\t\t\t\ttype: true,\r\n\t\t\t\t\ttitle: task.title,\r\n\t\t\t\t\timg: task.img?task.img:'help',\r\n\t\t\t\t\tdatetime: task.datetime\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn $firebase(ref.child('user_tasks').child(task.poster)).$push(obj);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tcreateUserTasks: function(taskId) {\r\n\t\t\tTask.getTask(taskId)\r\n\t\t\t\t.$asObject()\r\n\t\t\t\t.$loaded()\r\n\t\t\t\t.then(function(task) {\r\n\r\n\t\t\t\t\t// Create User-Tasks lookup record for RUNNER\r\n\t\t\t\t\tvar obj = {\r\n\t\t\t\t\t\ttaskId: taskId,\r\n\t\t\t\t\t\ttype: false,\r\n\t\t\t\t\t\ttitle: task.title,\r\n\t\t\t\t\t\tdatetime: task.datetime\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn $firebase(ref.child('user_tasks').child(task.runner)).$push(obj);\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\teditTask: function(task) {\r\n\t\t\tvar t = this.getTask(task.$id);\r\n\t\t\treturn t.$update({title: task.title, description: task.description});\r\n\t\t},\r\n\r\n\t\tcancelTask: function(taskId) {\r\n\t\t\tvar t = this.getTask(taskId);\r\n\t\t\treturn t.$update({status: 'cancelled'});\r\n\t\t},\r\n\r\n\t\tisCreator: function(task) {\r\n\t\t\treturn (user && user.provider && user.uid === task.poster);\r\n\t\t},\r\n\r\n\t\tisOpen: function(task) {\r\n\t\t\treturn task.status === 'open';\r\n\t\t},\r\n\r\n\t\t// --------------------------------------------------//\r\n\r\n\t\tisAssignee: function(task) {\r\n\t\t\treturn (user && user.provider && user.uid === task.runner);\r\n\t\t},\r\n\r\n\t\tcompleteTask: function(taskId) {\r\n\t\t\tvar t = this.getTask(taskId);\r\n\t\t\treturn t.$update({status: 'completed'});\r\n\t\t},\r\n\r\n\t\tisAssigned: function(task) {\r\n\t\t\treturn task.status === 'assigned';\r\n\t\t},\r\n\r\n\t\tisCompleted: function(task) {\r\n\t\t\treturn task.status === 'completed';\r\n\t\t}\r\n\t};\r\n\r\n\treturn Task;\r\n\r\n});\r\n"],"file":"task.js"}