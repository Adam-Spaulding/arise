{"version":3,"names":[],"mappings":"","sources":["services/auth.js"],"sourcesContent":["'use strict';\n\napp.factory('Auth', function(FURL, $firebaseAuth, $firebase) {\n\n\tvar ref = new Firebase(FURL);\n\tvar auth = $firebaseAuth(ref);\n\n\tvar Auth = {\n\t\tuser: {},\n\n    createProfile: function(uid, user,fbAuth) {\n      var profile = {\n        name: user.name,\n        email: user.email,\n        gravatar: user.img?user.img:get_gravatar(user.email, 40)\n      };\n      if(fbAuth){\n        profile.fbuid = user.uid;\n      }\n\n      var profileRef = $firebase(ref.child('profile').child(uid));\n      return profileRef.$update(profile);\n    },\n\n    getProfile: function(uid) {\n      return $firebase(ref.child('profile').child(uid)).$asObject();\n    },\n\n    login: function(user) {\n      return auth.$authWithPassword(\n        {email: user.email, password: user.password}\n      );\n    },\n\n    register: function(user) {\n      return auth.$createUser({email: user.email, password: user.password})\n        .then(function() {\n          // authenticate so we have permission to write to Firebase\n          return Auth.login(user);\n        })\n        .then(function(data) {\n          // store user data in Firebase after creating account\n          return Auth.createProfile(data.uid, user);\n        });\n    },\n\n    logout: function() {\n      auth.$unauth();\n\t\t\twindow.location.href = \"/\";\n    },\n\n\t\tchangePassword: function(user) {\n\t\t\treturn auth.$changePassword({email: user.email, oldPassword: user.oldPass, newPassword: user.newPass});\n\t\t},\n\n    signedIn: function() {\n      return !!Auth.user.provider; //using !! means (0, undefined, null, etc) = false | otherwise = true\n    },\n\n    requireAuth: function() {\n      return auth.$requireAuth();\n    },\n    fbAuth: function(success) {\n      var fbUser = {}\n      return ref.authWithOAuthPopup(\"facebook\", function(error, authData) {\n        console.log(error,authData)\n        if(authData){\n          fbUser.name = authData.facebook.cachedUserProfile.name;\n          fbUser.email = authData.facebook.email;\n          fbUser.img = authData.facebook.profileImageURL;\n          fbUser.uid = authData.facebook.cachedUserProfile.id;\n          Auth.createProfile(authData.auth.uid, fbUser,'facebookAuth');\n          success(authData)\n        }else{\n          console.log(error)\n        }\n      }, {\n        remember: \"sessionOnly\",\n        scope: \"email\"\n      })\n    }\n\n\t};\n\n\tauth.$onAuth(function(authData) {\n\t\tif(authData) {\n      angular.copy(authData, Auth.user);\n      Auth.user.profile = $firebase(ref.child('profile').child(authData.uid)).$asObject();\n\t\t} else {\n      if(Auth.user && Auth.user.profile) {\n        Auth.user.profile.$destroy();\n      }\n\n      angular.copy({}, Auth.user);\n\t\t}\n\t});\n\n\tfunction get_gravatar(email, size) {\n\n      email = email.toLowerCase();\n\n      var MD5 = function(s) {\n        function L(k, d) {\n          return (k << d) | (k >>> (32 - d))\n        }\n\n        function K(G, k) {\n          var I, d, F, H, x;\n          F = (G & 2147483648);\n          H = (k & 2147483648);\n          I = (G & 1073741824);\n          d = (k & 1073741824);\n          x = (G & 1073741823) + (k & 1073741823);\n          if (I & d) {\n            return (x ^ 2147483648 ^ F ^ H)\n          }\n          if (I | d) {\n            if (x & 1073741824) {\n              return (x ^ 3221225472 ^ F ^ H)\n            } else {\n              return (x ^ 1073741824 ^ F ^ H)\n            }\n          } else {\n            return (x ^ F ^ H)\n          }\n        }\n\n        function r(d, F, k) {\n          return (d & F) | ((~d) & k)\n        }\n\n        function q(d, F, k) {\n          return (d & k) | (F & (~k))\n        }\n\n        function p(d, F, k) {\n          return (d ^ F ^ k)\n        }\n\n        function n(d, F, k) {\n          return (F ^ (d | (~k)))\n        }\n\n        function u(G, F, aa, Z, k, H, I) {\n          G = K(G, K(K(r(F, aa, Z), k), I));\n          return K(L(G, H), F)\n        }\n\n        function f(G, F, aa, Z, k, H, I) {\n          G = K(G, K(K(q(F, aa, Z), k), I));\n          return K(L(G, H), F)\n        }\n\n        function D(G, F, aa, Z, k, H, I) {\n          G = K(G, K(K(p(F, aa, Z), k), I));\n          return K(L(G, H), F)\n        }\n\n        function t(G, F, aa, Z, k, H, I) {\n          G = K(G, K(K(n(F, aa, Z), k), I));\n          return K(L(G, H), F)\n        }\n\n        function e(G) {\n          var Z;\n          var F = G.length;\n          var x = F + 8;\n          var k = (x - (x % 64)) / 64;\n          var I = (k + 1) * 16;\n          var aa = Array(I - 1);\n          var d = 0;\n          var H = 0;\n          while (H < F) {\n            Z = (H - (H % 4)) / 4;\n            d = (H % 4) * 8;\n            aa[Z] = (aa[Z] | (G.charCodeAt(H) << d));\n            H++\n          }\n          Z = (H - (H % 4)) / 4;\n          d = (H % 4) * 8;\n          aa[Z] = aa[Z] | (128 << d);\n          aa[I - 2] = F << 3;\n          aa[I - 1] = F >>> 29;\n          return aa\n        }\n\n        function B(x) {\n          var k = '',\n            F = '',\n            G, d;\n          for (d = 0; d <= 3; d++) {\n            G = (x >>> (d * 8)) & 255;\n            F = '0' + G.toString(16);\n            k = k + F.substr(F.length - 2, 2)\n          }\n          return k\n        }\n\n        function J(k) {\n          k = k.replace(/rn/g, 'n');\n          var d = '';\n          for (var F = 0; F < k.length; F++) {\n            var x = k.charCodeAt(F);\n            if (x < 128) {\n              d += String.fromCharCode(x)\n            } else {\n              if ((x > 127) && (x < 2048)) {\n                d += String.fromCharCode((x >> 6) | 192);\n                d += String.fromCharCode((x & 63) | 128)\n              } else {\n                d += String.fromCharCode((x >> 12) | 224);\n                d += String.fromCharCode(((x >> 6) & 63) | 128);\n                d += String.fromCharCode((x & 63) | 128)\n              }\n            }\n          }\n          return d\n        }\n        var C = Array();\n        var P, h, E, v, g, Y, X, W, V;\n        var S = 7,\n          Q = 12,\n          N = 17,\n          M = 22;\n        var A = 5,\n          z = 9,\n          y = 14,\n          w = 20;\n        var o = 4,\n          m = 11,\n          l = 16,\n          j = 23;\n        var U = 6,\n          T = 10,\n          R = 15,\n          O = 21;\n        s = J(s);\n        C = e(s);\n        Y = 1732584193;\n        X = 4023233417;\n        W = 2562383102;\n        V = 271733878;\n        for (P = 0; P < C.length; P += 16) {\n          h = Y;\n          E = X;\n          v = W;\n          g = V;\n          Y = u(Y, X, W, V, C[P + 0], S, 3614090360);\n          V = u(V, Y, X, W, C[P + 1], Q, 3905402710);\n          W = u(W, V, Y, X, C[P + 2], N, 606105819);\n          X = u(X, W, V, Y, C[P + 3], M, 3250441966);\n          Y = u(Y, X, W, V, C[P + 4], S, 4118548399);\n          V = u(V, Y, X, W, C[P + 5], Q, 1200080426);\n          W = u(W, V, Y, X, C[P + 6], N, 2821735955);\n          X = u(X, W, V, Y, C[P + 7], M, 4249261313);\n          Y = u(Y, X, W, V, C[P + 8], S, 1770035416);\n          V = u(V, Y, X, W, C[P + 9], Q, 2336552879);\n          W = u(W, V, Y, X, C[P + 10], N, 4294925233);\n          X = u(X, W, V, Y, C[P + 11], M, 2304563134);\n          Y = u(Y, X, W, V, C[P + 12], S, 1804603682);\n          V = u(V, Y, X, W, C[P + 13], Q, 4254626195);\n          W = u(W, V, Y, X, C[P + 14], N, 2792965006);\n          X = u(X, W, V, Y, C[P + 15], M, 1236535329);\n          Y = f(Y, X, W, V, C[P + 1], A, 4129170786);\n          V = f(V, Y, X, W, C[P + 6], z, 3225465664);\n          W = f(W, V, Y, X, C[P + 11], y, 643717713);\n          X = f(X, W, V, Y, C[P + 0], w, 3921069994);\n          Y = f(Y, X, W, V, C[P + 5], A, 3593408605);\n          V = f(V, Y, X, W, C[P + 10], z, 38016083);\n          W = f(W, V, Y, X, C[P + 15], y, 3634488961);\n          X = f(X, W, V, Y, C[P + 4], w, 3889429448);\n          Y = f(Y, X, W, V, C[P + 9], A, 568446438);\n          V = f(V, Y, X, W, C[P + 14], z, 3275163606);\n          W = f(W, V, Y, X, C[P + 3], y, 4107603335);\n          X = f(X, W, V, Y, C[P + 8], w, 1163531501);\n          Y = f(Y, X, W, V, C[P + 13], A, 2850285829);\n          V = f(V, Y, X, W, C[P + 2], z, 4243563512);\n          W = f(W, V, Y, X, C[P + 7], y, 1735328473);\n          X = f(X, W, V, Y, C[P + 12], w, 2368359562);\n          Y = D(Y, X, W, V, C[P + 5], o, 4294588738);\n          V = D(V, Y, X, W, C[P + 8], m, 2272392833);\n          W = D(W, V, Y, X, C[P + 11], l, 1839030562);\n          X = D(X, W, V, Y, C[P + 14], j, 4259657740);\n          Y = D(Y, X, W, V, C[P + 1], o, 2763975236);\n          V = D(V, Y, X, W, C[P + 4], m, 1272893353);\n          W = D(W, V, Y, X, C[P + 7], l, 4139469664);\n          X = D(X, W, V, Y, C[P + 10], j, 3200236656);\n          Y = D(Y, X, W, V, C[P + 13], o, 681279174);\n          V = D(V, Y, X, W, C[P + 0], m, 3936430074);\n          W = D(W, V, Y, X, C[P + 3], l, 3572445317);\n          X = D(X, W, V, Y, C[P + 6], j, 76029189);\n          Y = D(Y, X, W, V, C[P + 9], o, 3654602809);\n          V = D(V, Y, X, W, C[P + 12], m, 3873151461);\n          W = D(W, V, Y, X, C[P + 15], l, 530742520);\n          X = D(X, W, V, Y, C[P + 2], j, 3299628645);\n          Y = t(Y, X, W, V, C[P + 0], U, 4096336452);\n          V = t(V, Y, X, W, C[P + 7], T, 1126891415);\n          W = t(W, V, Y, X, C[P + 14], R, 2878612391);\n          X = t(X, W, V, Y, C[P + 5], O, 4237533241);\n          Y = t(Y, X, W, V, C[P + 12], U, 1700485571);\n          V = t(V, Y, X, W, C[P + 3], T, 2399980690);\n          W = t(W, V, Y, X, C[P + 10], R, 4293915773);\n          X = t(X, W, V, Y, C[P + 1], O, 2240044497);\n          Y = t(Y, X, W, V, C[P + 8], U, 1873313359);\n          V = t(V, Y, X, W, C[P + 15], T, 4264355552);\n          W = t(W, V, Y, X, C[P + 6], R, 2734768916);\n          X = t(X, W, V, Y, C[P + 13], O, 1309151649);\n          Y = t(Y, X, W, V, C[P + 4], U, 4149444226);\n          V = t(V, Y, X, W, C[P + 11], T, 3174756917);\n          W = t(W, V, Y, X, C[P + 2], R, 718787259);\n          X = t(X, W, V, Y, C[P + 9], O, 3951481745);\n          Y = K(Y, h);\n          X = K(X, E);\n          W = K(W, v);\n          V = K(V, g)\n        }\n        var i = B(Y) + B(X) + B(W) + B(V);\n        return i.toLowerCase()\n      };\n\n      var size = size || 80;\n\n      return 'https://www.gravatar.com/avatar/' + MD5(email) + '.jpg?d=identicon';\n    }\n\n\treturn Auth;\n\n});\n"],"file":"auth.js"}