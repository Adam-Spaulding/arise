{"version":3,"names":[],"mappings":"","sources":["services/auth.js"],"sourcesContent":["'use strict';\r\n\r\napp.factory('Auth', function(FURL, $firebaseAuth, $firebase) {\r\n\r\n\tvar ref = new Firebase(FURL);\r\n\tvar auth = $firebaseAuth(ref);\r\n\r\n\tvar Auth = {\r\n\t\tuser: {},\r\n\r\n    createProfile: function(uid, user,fbAuth) {\r\n      var profile = {\r\n        name: user.name,\r\n        email: user.email,\r\n        gravatar: user.img?user.img:get_gravatar(user.email, 40)\r\n      };\r\n      if(fbAuth){\r\n        profile.fbuid = user.uid;\r\n      }\r\n\r\n      var profileRef = $firebase(ref.child('profile').child(uid));\r\n      return profileRef.$update(profile);\r\n    },\r\n\r\n    getProfile: function(uid) {\r\n      return $firebase(ref.child('profile').child(uid)).$asObject();\r\n    },\r\n\r\n    login: function(user) {\r\n      return auth.$authWithPassword(\r\n        {email: user.email, password: user.password}\r\n      );\r\n    },\r\n\r\n    register: function(user) {\r\n      return auth.$createUser({email: user.email, password: user.password})\r\n        .then(function() {\r\n          // authenticate so we have permission to write to Firebase\r\n          return Auth.login(user);\r\n        })\r\n        .then(function(data) {\r\n          // store user data in Firebase after creating account\r\n          return Auth.createProfile(data.uid, user);\r\n        });\r\n    },\r\n\r\n    logout: function() {\r\n      auth.$unauth();\r\n\t\t\twindow.location.href = \"/\";\r\n    },\r\n\r\n\t\tchangePassword: function(user) {\r\n\t\t\treturn auth.$changePassword({email: user.email, oldPassword: user.oldPass, newPassword: user.newPass});\r\n\t\t},\r\n\r\n    signedIn: function() {\r\n      return !!Auth.user.provider; //using !! means (0, undefined, null, etc) = false | otherwise = true\r\n    },\r\n\r\n    requireAuth: function() {\r\n      return auth.$requireAuth();\r\n    },\r\n    fbAuth: function(success) {\r\n      var fbUser = {}\r\n      return ref.authWithOAuthPopup(\"facebook\", function(error, authData) {\r\n        console.log(error,authData)\r\n        if(authData){\r\n          fbUser.name = authData.facebook.cachedUserProfile.name;\r\n          fbUser.email = authData.facebook.email;\r\n          fbUser.img = authData.facebook.profileImageURL;\r\n          fbUser.uid = authData.facebook.cachedUserProfile.id;\r\n          Auth.createProfile(authData.auth.uid, fbUser,'facebookAuth');\r\n          success(authData)\r\n        }else{\r\n          console.log(error)\r\n        }\r\n      }, {\r\n        remember: \"sessionOnly\",\r\n        scope: \"email\"\r\n      })\r\n    }\r\n\r\n\t};\r\n\r\n\tauth.$onAuth(function(authData) {\r\n\t\tif(authData) {\r\n      angular.copy(authData, Auth.user);\r\n      Auth.user.profile = $firebase(ref.child('profile').child(authData.uid)).$asObject();\r\n\t\t} else {\r\n      if(Auth.user && Auth.user.profile) {\r\n        Auth.user.profile.$destroy();\r\n      }\r\n\r\n      angular.copy({}, Auth.user);\r\n\t\t}\r\n\t});\r\n\r\n\tfunction get_gravatar(email, size) {\r\n\r\n      email = email.toLowerCase();\r\n\r\n      var MD5 = function(s) {\r\n        function L(k, d) {\r\n          return (k << d) | (k >>> (32 - d))\r\n        }\r\n\r\n        function K(G, k) {\r\n          var I, d, F, H, x;\r\n          F = (G & 2147483648);\r\n          H = (k & 2147483648);\r\n          I = (G & 1073741824);\r\n          d = (k & 1073741824);\r\n          x = (G & 1073741823) + (k & 1073741823);\r\n          if (I & d) {\r\n            return (x ^ 2147483648 ^ F ^ H)\r\n          }\r\n          if (I | d) {\r\n            if (x & 1073741824) {\r\n              return (x ^ 3221225472 ^ F ^ H)\r\n            } else {\r\n              return (x ^ 1073741824 ^ F ^ H)\r\n            }\r\n          } else {\r\n            return (x ^ F ^ H)\r\n          }\r\n        }\r\n\r\n        function r(d, F, k) {\r\n          return (d & F) | ((~d) & k)\r\n        }\r\n\r\n        function q(d, F, k) {\r\n          return (d & k) | (F & (~k))\r\n        }\r\n\r\n        function p(d, F, k) {\r\n          return (d ^ F ^ k)\r\n        }\r\n\r\n        function n(d, F, k) {\r\n          return (F ^ (d | (~k)))\r\n        }\r\n\r\n        function u(G, F, aa, Z, k, H, I) {\r\n          G = K(G, K(K(r(F, aa, Z), k), I));\r\n          return K(L(G, H), F)\r\n        }\r\n\r\n        function f(G, F, aa, Z, k, H, I) {\r\n          G = K(G, K(K(q(F, aa, Z), k), I));\r\n          return K(L(G, H), F)\r\n        }\r\n\r\n        function D(G, F, aa, Z, k, H, I) {\r\n          G = K(G, K(K(p(F, aa, Z), k), I));\r\n          return K(L(G, H), F)\r\n        }\r\n\r\n        function t(G, F, aa, Z, k, H, I) {\r\n          G = K(G, K(K(n(F, aa, Z), k), I));\r\n          return K(L(G, H), F)\r\n        }\r\n\r\n        function e(G) {\r\n          var Z;\r\n          var F = G.length;\r\n          var x = F + 8;\r\n          var k = (x - (x % 64)) / 64;\r\n          var I = (k + 1) * 16;\r\n          var aa = Array(I - 1);\r\n          var d = 0;\r\n          var H = 0;\r\n          while (H < F) {\r\n            Z = (H - (H % 4)) / 4;\r\n            d = (H % 4) * 8;\r\n            aa[Z] = (aa[Z] | (G.charCodeAt(H) << d));\r\n            H++\r\n          }\r\n          Z = (H - (H % 4)) / 4;\r\n          d = (H % 4) * 8;\r\n          aa[Z] = aa[Z] | (128 << d);\r\n          aa[I - 2] = F << 3;\r\n          aa[I - 1] = F >>> 29;\r\n          return aa\r\n        }\r\n\r\n        function B(x) {\r\n          var k = '',\r\n            F = '',\r\n            G, d;\r\n          for (d = 0; d <= 3; d++) {\r\n            G = (x >>> (d * 8)) & 255;\r\n            F = '0' + G.toString(16);\r\n            k = k + F.substr(F.length - 2, 2)\r\n          }\r\n          return k\r\n        }\r\n\r\n        function J(k) {\r\n          k = k.replace(/rn/g, 'n');\r\n          var d = '';\r\n          for (var F = 0; F < k.length; F++) {\r\n            var x = k.charCodeAt(F);\r\n            if (x < 128) {\r\n              d += String.fromCharCode(x)\r\n            } else {\r\n              if ((x > 127) && (x < 2048)) {\r\n                d += String.fromCharCode((x >> 6) | 192);\r\n                d += String.fromCharCode((x & 63) | 128)\r\n              } else {\r\n                d += String.fromCharCode((x >> 12) | 224);\r\n                d += String.fromCharCode(((x >> 6) & 63) | 128);\r\n                d += String.fromCharCode((x & 63) | 128)\r\n              }\r\n            }\r\n          }\r\n          return d\r\n        }\r\n        var C = Array();\r\n        var P, h, E, v, g, Y, X, W, V;\r\n        var S = 7,\r\n          Q = 12,\r\n          N = 17,\r\n          M = 22;\r\n        var A = 5,\r\n          z = 9,\r\n          y = 14,\r\n          w = 20;\r\n        var o = 4,\r\n          m = 11,\r\n          l = 16,\r\n          j = 23;\r\n        var U = 6,\r\n          T = 10,\r\n          R = 15,\r\n          O = 21;\r\n        s = J(s);\r\n        C = e(s);\r\n        Y = 1732584193;\r\n        X = 4023233417;\r\n        W = 2562383102;\r\n        V = 271733878;\r\n        for (P = 0; P < C.length; P += 16) {\r\n          h = Y;\r\n          E = X;\r\n          v = W;\r\n          g = V;\r\n          Y = u(Y, X, W, V, C[P + 0], S, 3614090360);\r\n          V = u(V, Y, X, W, C[P + 1], Q, 3905402710);\r\n          W = u(W, V, Y, X, C[P + 2], N, 606105819);\r\n          X = u(X, W, V, Y, C[P + 3], M, 3250441966);\r\n          Y = u(Y, X, W, V, C[P + 4], S, 4118548399);\r\n          V = u(V, Y, X, W, C[P + 5], Q, 1200080426);\r\n          W = u(W, V, Y, X, C[P + 6], N, 2821735955);\r\n          X = u(X, W, V, Y, C[P + 7], M, 4249261313);\r\n          Y = u(Y, X, W, V, C[P + 8], S, 1770035416);\r\n          V = u(V, Y, X, W, C[P + 9], Q, 2336552879);\r\n          W = u(W, V, Y, X, C[P + 10], N, 4294925233);\r\n          X = u(X, W, V, Y, C[P + 11], M, 2304563134);\r\n          Y = u(Y, X, W, V, C[P + 12], S, 1804603682);\r\n          V = u(V, Y, X, W, C[P + 13], Q, 4254626195);\r\n          W = u(W, V, Y, X, C[P + 14], N, 2792965006);\r\n          X = u(X, W, V, Y, C[P + 15], M, 1236535329);\r\n          Y = f(Y, X, W, V, C[P + 1], A, 4129170786);\r\n          V = f(V, Y, X, W, C[P + 6], z, 3225465664);\r\n          W = f(W, V, Y, X, C[P + 11], y, 643717713);\r\n          X = f(X, W, V, Y, C[P + 0], w, 3921069994);\r\n          Y = f(Y, X, W, V, C[P + 5], A, 3593408605);\r\n          V = f(V, Y, X, W, C[P + 10], z, 38016083);\r\n          W = f(W, V, Y, X, C[P + 15], y, 3634488961);\r\n          X = f(X, W, V, Y, C[P + 4], w, 3889429448);\r\n          Y = f(Y, X, W, V, C[P + 9], A, 568446438);\r\n          V = f(V, Y, X, W, C[P + 14], z, 3275163606);\r\n          W = f(W, V, Y, X, C[P + 3], y, 4107603335);\r\n          X = f(X, W, V, Y, C[P + 8], w, 1163531501);\r\n          Y = f(Y, X, W, V, C[P + 13], A, 2850285829);\r\n          V = f(V, Y, X, W, C[P + 2], z, 4243563512);\r\n          W = f(W, V, Y, X, C[P + 7], y, 1735328473);\r\n          X = f(X, W, V, Y, C[P + 12], w, 2368359562);\r\n          Y = D(Y, X, W, V, C[P + 5], o, 4294588738);\r\n          V = D(V, Y, X, W, C[P + 8], m, 2272392833);\r\n          W = D(W, V, Y, X, C[P + 11], l, 1839030562);\r\n          X = D(X, W, V, Y, C[P + 14], j, 4259657740);\r\n          Y = D(Y, X, W, V, C[P + 1], o, 2763975236);\r\n          V = D(V, Y, X, W, C[P + 4], m, 1272893353);\r\n          W = D(W, V, Y, X, C[P + 7], l, 4139469664);\r\n          X = D(X, W, V, Y, C[P + 10], j, 3200236656);\r\n          Y = D(Y, X, W, V, C[P + 13], o, 681279174);\r\n          V = D(V, Y, X, W, C[P + 0], m, 3936430074);\r\n          W = D(W, V, Y, X, C[P + 3], l, 3572445317);\r\n          X = D(X, W, V, Y, C[P + 6], j, 76029189);\r\n          Y = D(Y, X, W, V, C[P + 9], o, 3654602809);\r\n          V = D(V, Y, X, W, C[P + 12], m, 3873151461);\r\n          W = D(W, V, Y, X, C[P + 15], l, 530742520);\r\n          X = D(X, W, V, Y, C[P + 2], j, 3299628645);\r\n          Y = t(Y, X, W, V, C[P + 0], U, 4096336452);\r\n          V = t(V, Y, X, W, C[P + 7], T, 1126891415);\r\n          W = t(W, V, Y, X, C[P + 14], R, 2878612391);\r\n          X = t(X, W, V, Y, C[P + 5], O, 4237533241);\r\n          Y = t(Y, X, W, V, C[P + 12], U, 1700485571);\r\n          V = t(V, Y, X, W, C[P + 3], T, 2399980690);\r\n          W = t(W, V, Y, X, C[P + 10], R, 4293915773);\r\n          X = t(X, W, V, Y, C[P + 1], O, 2240044497);\r\n          Y = t(Y, X, W, V, C[P + 8], U, 1873313359);\r\n          V = t(V, Y, X, W, C[P + 15], T, 4264355552);\r\n          W = t(W, V, Y, X, C[P + 6], R, 2734768916);\r\n          X = t(X, W, V, Y, C[P + 13], O, 1309151649);\r\n          Y = t(Y, X, W, V, C[P + 4], U, 4149444226);\r\n          V = t(V, Y, X, W, C[P + 11], T, 3174756917);\r\n          W = t(W, V, Y, X, C[P + 2], R, 718787259);\r\n          X = t(X, W, V, Y, C[P + 9], O, 3951481745);\r\n          Y = K(Y, h);\r\n          X = K(X, E);\r\n          W = K(W, v);\r\n          V = K(V, g)\r\n        }\r\n        var i = B(Y) + B(X) + B(W) + B(V);\r\n        return i.toLowerCase()\r\n      };\r\n\r\n      var size = size || 80;\r\n\r\n      return 'https://www.gravatar.com/avatar/' + MD5(email) + '.jpg?d=identicon';\r\n    }\r\n\r\n\treturn Auth;\r\n\r\n});\r\n"],"file":"auth.js"}